# OpenLDAP Meta Backend Configuration
# Provides unified LDAP interface for Passbolt synchronization
# Aggregates results from multiple backend LDAP servers

# Include schema files
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/nis.schema

# Global configuration
pidfile /var/run/slapd/slapd.pid
argsfile /var/run/slapd/slapd.args

# Logging
loglevel stats

# TLS Configuration
TLSCertificateFile /etc/ssl/certs/ldap-meta.crt
TLSCertificateKeyFile /etc/ssl/certs/ldap-meta.key
TLSCACertificateFile /etc/ssl/certs/ca.crt

# Database configuration
database meta
suffix "dc=unified,dc=local"
uri "ldap://ldap1.local:389/dc=passbolt,dc=local"
uri "ldap://ldap2.local:389/dc=example,dc=com"

# Meta backend options
meta-overlay on
meta-backend-uri "ldap://ldap1.local:389/dc=passbolt,dc=local"
meta-backend-uri "ldap://ldap2.local:389/dc=example,dc=com"

# Access control
access to *
    by dn="cn=admin,dc=unified,dc=local" write
    by dn="cn=readonly,dc=unified,dc=local" read
    by * none

# Root DSE
dn: dc=unified,dc=local
objectClass: top
objectClass: domain
dc: unified

# Admin user for unified namespace
dn: cn=admin,dc=unified,dc=local
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator for unified namespace
userPassword: secret

# Readonly user for Passbolt sync
dn: cn=readonly,dc=unified,dc=local
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: readonly
description: Read-only user for Passbolt directory sync
userPassword: readonly
